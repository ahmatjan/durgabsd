m4_dnl -*-html-*-
m4_include(`template.m4')

m4_dnl OpenVAS
m4_dnl $Id$
m4_dnl Description: OpenVAS Change Request #43
m4_dnl
m4_dnl Authors:
m4_dnl Chandrashekhar B <bchandra@secpod.com>
m4_dnl
m4_dnl Copyright:
m4_dnl Copyright (C) 2010 SecPod.
m4_dnl
m4_dnl This program is free software; you can redistribute it and/or modify
m4_dnl it under the terms of the GNU General Public License version 2,
m4_dnl or, at your option, any later version as published by the Free
m4_dnl Software Foundation
m4_dnl
m4_dnl This program is distributed in the hope that it will be useful,
m4_dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
m4_dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
m4_dnl GNU General Public License for more details.
m4_dnl
m4_dnl You should have received a copy of the GNU General Public License
m4_dnl along with this program; if not, write to the Free Software
m4_dnl Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.

m4_define(`EN')
m4_define(`TITLE', `OpenVAS')
m4_define(`MAIN', `misc')



PAGE_START
<h2>OpenVAS Change Request #43: NMAP based service detection</h2>

<p>
Status: In Progress.
</p>

<h3>Purpose</h3>

<p>
<ol>
<li> To consider replacing "C" plugin find_service.c with a NASL equivalent,
and to make use of the NMAP's service detection capabilities. This is an
extension to CR #40.
<li> Extend NVT feed to distribute NMAP's service db files
</ol>
</p>

<h3>References</h3>
<a href="openvas-cr-40.html">OpenVAS Change Request #40: find_service.c and
NMAP service detection</a>

<h3>Rationale</h3>

<p>
Currently, service detection is accomplished by "C" plugin find_service.c, and
is supplemented with additional service detection plugins find_service1.nasl,
find_service2.nasl and find_service_3digits.nasl. It is a general goal to avoid,
and if possible, to replace existing "C" plugins as they cannot be updated
except during updates of the actual daemon.

<p>
Once the C based plugin is replaced with NMAP based service detection, the
service db file of NMAP, as and when there's an update, should also be provided
with OpenVAS NVT feed. This will ensure that service detection is seamlessly
addressed, without user intervention.
</p>


<h3>Effects</h3>

<p>
The idea is to completely replace find_service.c with nmap/NASL based
equivalents. There may be certain services where find_service.c fares better
compared to NMAP. A thorough review exercise has to be carried out and a fall
back mechanim may be needed for some time till NMAP addresses any such issues
identified during review.
</p>

<p>
Completely relying on NMAP for service detection induces permanent dependency
on an external tool. And NVT feed will contain an additional service db file 
from NMAP, which may be seen as an external component.
</p>

<h3>Design and Implementation</h3>

<p>
<ol>
<li><b>Replacement of find_service.c:</b>
</p>

<p> Review service detection logic for each service in find_service.c and find
an equivalent in NMAP.
<pre>
    - if an equivalent is present, the one in the find_service.c can be
      removed. Also, any place where the corresponding Service KB is being
      used, the new kb from NMAP should be used.
    - if the find_service.c has a detection that is not present in NMAP,
      consider updating the NMAP db if possible or open a discussion on the
      NMAP mailing list.
    - Till the time there's an equivalent solution available through NMAP,
      retain find_service.c for those specific modules.
</pre>
</p>

<p>
<li><b>Update find_service_nmap.nasl </b>
</p>

<p>
Updated the above module to launch service detection for all services by
default and not just unknown services. This will become the de facto service
detection module for OpenVAS apart from few other NASL's that already exist
like find_service1.nasl, find_service2.nasl and find_service_3digits.nasl. 
These modules will be retained based on their ability to do better than NMAP.
</p>

<li><b>Service db distribution</b>
<p>
nmap-services and nmap-service-probes files will be distributed as part of OpenVAS
NVT feed and find_service_nmap.nasl will be updated with --datadir options to point
to these distrbutions. This will give option to add/delete service probes and also
sign the db's.
</p>
</ol>

<h3>History</h3>

<ul>
<li> 2010-02-25 Chandrashekhar B &lt;bchandra@secpod.com&gt;:<br>
     Initial text.</li>
</ul>
