<%
# Apache runs this script for the url http://www.openvas.org/
# If the oid= query parameter is given, this script redirects the browser
# to the script's viewcvs page if a plugin was found for this oid and to an
# error page if not. Without an oid parameter it does an apache-internal
# redirect to index.html.

import os.path

# by default, redirect internally to index.html.
redirect_to = "http://www.openvas.org/index.html"
redirector = req.internal_redirect

svn_url_template = ("http://wald.intevation.org/scm/viewvco.php/"
                    "scripts/%s?root=openvas-nvts&view=markup")

def lookup_oid(filename, oid):
    for line in open(filename):
        found_oid, filename = line.split(None, 1)
        if found_oid == oid:
            return filename.strip()
    return None

oid = form.getfirst("oid")
if oid:
    redirector = psp.redirect
    redirect_to = "http://www.openvas.org/nvt-not-found.html"
    filename = os.path.join(os.path.dirname(req.filename), "oidmapping.txt")
    script_name = lookup_oid(filename, oid)
    if script_name is not None:
        redirect_to = svn_url_template % (script_name,)

redirector(redirect_to)
#
%>
