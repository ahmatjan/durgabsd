m4_dnl -*-html-*-
m4_include(`template.m4')

m4_dnl OpenVAS
m4_dnl $Id$
m4_dnl Description: OpenVAS Change Request #39
m4_dnl
m4_dnl Authors:
m4_dnl Jan-Oliver Wagner <jan-oliver.wagner@greenbone.net>
m4_dnl
m4_dnl Copyright:
m4_dnl Copyright (C) 2009 Greenbone Networks GmbH
m4_dnl
m4_dnl This program is free software; you can redistribute it and/or
m4_dnl modify it under the terms of the GNU General Public License
m4_dnl as published by the Free Software Foundation; either version 2
m4_dnl of the License, or (at your option) any later version.
m4_dnl
m4_dnl This program is distributed in the hope that it will be useful,
m4_dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
m4_dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
m4_dnl GNU General Public License for more details.
m4_dnl
m4_dnl You should have received a copy of the GNU General Public License
m4_dnl along with this program; if not, write to the Free Software
m4_dnl Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.

m4_define(`EN')
m4_define(`TITLE', `OpenVAS')
m4_define(`MAIN', `misc')



PAGE_START
<h2>OpenVAS Change Request #39: Mandatory KB keys</h2>

<p>
Status: Voted +6. Done. 2009-08-01: All changes are in SVN, including
trunk and 2-0 as well as openvas-conpendium.
</p>

<h3>Purpose</h3>

<p>
To allow defining scripts that in no circumstances make
sense to be loaded and executed if a specific key in the
knowledge base is missing.
</p>

<h3>References</h3>

<p>
</p>

<h3>Rationale</h3>

<p>
Currently, scripts can specify a "required key".
The script will not be executed in case the key
is missing in the knowledge base.
However, this is only true in case the preference
"optimize tests" is switched on.
</p>

<p>
In case of non-optimized tests, the list of
required keys is disregarded and the NVTs are executed
nonetheless. This does indeed make sense and many
scripts rely on this behaviour as they can
do something sensible even without the keys.
</p>

<p>
However, for many scripts it makes no sense
to run if a certain key is missing. Such scripts
rely entirely on the presense of the key.
</p>

<h3>Effects</h3>

<p>
New NVTs might use the "script_mandatory_keys()" method
in the description sections. Older version of the
scanner will send a error message to the log file each time
they parse this code line. However, this does not
affect the execution of the script, the scanner will just
ignore the absence of the function.
Alternatively, each call of the that function can be
wrapped with "if defined_func()", but that adds only code
that later is to be removed again. Decision on wether
this is to be used should made upon the number of
log that is produced - huge amounts should be avoided.
</p>

<p>
The information on mandatory keys needs to be stored
in the cache as well and thus, the cache needs to
be invalidated once to get this new feature working.
For 2.0 series, this automatically happens with a
new release of openvas-libraries. For 2.1/3.0 releases
this is not an issue at all because of the new dynamic
cache.
</p>

<h3>Design and Implementation</h3>

<p>
The implementation needs to establish the following changes:
</p>

<ul>
<li> Extend API of
     openvas-libraries/libopenvascommon/nvti.c to handle mandatory keys.
<li> Modify openvas-libraries/libopenvas/store.c to handle mandatory keys.
<li> Extend API of openvas-libraries/libopenvas/plugutils.c to handle
     mandatory keys.
<li> Extend API of openvas-server/openvasd/plugs_req.c to handle
     mandatory keys.
<li> Extend struct for scheduler_plugin with mandatory keys
     (openvas-server/openvasd/pluginscheduler.h)
<li> Modify openvas-server/openvasd/attack.c to consider mandatory keys.
<li> Add a respective function to openvas-libnasl/nasl/nasl_nessusd_glue.c
<li> Expose the function to NASL scripts in openvas-libnasl/nasl/nasl_init.c.
</ul>

<h3>History</h3>

<ul>
<li> 2009-08-01 Jan-Oliver Wagner &lt;jan-oliver.wagner@greenbone.net&gt;:<br>
     All works finished.</li>
<li> 2009-07-19 Jan-Oliver Wagner &lt;jan-oliver.wagner@intevation.de&gt;:<br>
     Added voting results. Now in progress.</li>
<li> 2009-07-14 Jan-Oliver Wagner &lt;jan-oliver.wagner@intevation.de&gt;:<br>
     Initial text.</li>
</ul>
