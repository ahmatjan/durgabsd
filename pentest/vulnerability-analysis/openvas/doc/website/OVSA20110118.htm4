m4_dnl -*-html-*-
m4_include(`template.m4')

m4_dnl OpenVAS
m4_dnl $Id$
m4_dnl Description: OpenVAS Security Advisory (OVSA20110118)
m4_dnl
m4_dnl Authors:
m4_dnl Tim Brown <timb@openvas.org>
m4_dnl
m4_dnl Copyright:
m4_dnl Copyright (C) 2010 Tim Brown
m4_dnl
m4_dnl This program is free software; you can redistribute it and/or modify
m4_dnl it under the terms of the GNU General Public License version 2,
m4_dnl or, at your option, any later version as published by the Free
m4_dnl Software Foundation
m4_dnl
m4_dnl This program is distributed in the hope that it will be useful,
m4_dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
m4_dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
m4_dnl GNU General Public License for more details.
m4_dnl
m4_dnl You should have received a copy of the GNU General Public License
m4_dnl along with this program; if not, write to the Free Software
m4_dnl Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.

m4_define(`EN')
m4_define(`TITLE', `OpenVAS')
m4_define(`MAIN', `misc')



PAGE_START
<h2>OpenVAS Security Advisory (OVSA20110118)</h2>

<p>
Date: 18th January 2011, updated 24th January 2011<br/>
Product: OpenVAS Manager &lt;= 1.0.3 and 2.0rc2<br/>
Vendor: OpenVAS &lt;http://www.openvas.org/&gt;<br/>
Risk: Medium
</p>

<h3>Summary</h3>

<p>
It has been identified that OpenVAS Manager is vulnerable to command
injection due to insufficient validation of user supplied data when
processing OMP requests.  It has been identified that this vulnerability
allows privilege escalation within the OpenVAS Manager but more complex
injection may allow arbitrary code to be executed with the privileges of
the OpenVAS Manager on vulnerable systems.  CVE-2011-0018 has been assigned
to this vulnerability.
</p>

<p>
The vulnerable code path is only accessible to authenticated users of
OpenVAS Manager however it may also be triggered either directly or
by using a cross-site request forgery based attack via the Greenbone
Security Assistant web application. CVE-2011-0650 has been assigned to this
vulnerability.
</p>

<h3>Current Status</h3>

<p>
As of the 24th January 2011, the state of the vulnerabilities is believed
to be as follows.  A patch has been supplied by Greenbone Networks which
it successfully resolves the command injection vulnerability.  New releases
of both 1.0.x and 2.0.x have also been created which incorporate this
patch. Note that the cross-site address forgery elements of this
vulnerability have not yet been addressed in the Greenbone Security
Assistant web application however the vulnerability will be resolved prior
to the release of OpenVAS 4.
</p>

<h3>Technical Details</h3>

<p>
It has been identified that OpenVAS Manager is vulnerable to command
injection due to insufficient validation of user supplied data when
processing OMP requests.  It has been identified that this vulnerability
allows an authenticated user of the Greenbone Security Assistant web
application (which communicates with OpenVAS Manager using OMP) to
escalate their privileges with just a few clicks although more complex
attacks may also be possible.
</p>

<p>
Escalation of privileges can be achieved accessing the Greenbone Security
Assistant, creating an escalator with a modified POST request as follows:
</p>

<pre>
Content-Disposition: form-data; name="method_data:to_address"

none@none>/var/lib/openvas/users/alexander/isadmin
</pre>

<p>
The processing of this request causes GSA to make a request to OpenVAS Manager
which causes the command below to be executed with the privileges of the
OpenVAS Manager (typically root) using the email() function from manage_sql.c:
</p>

<pre>
command = g_strdup_printf ("echo \""
                              "To: %s\n"
                              "From: %s\n"
                              "Subject: %s\n"
                              "\n"
                              "%s\""
                              " | /usr/sbin/sendmail %s"	 
                              " &gt; /dev/null 2&gt;&amp;1",	 
                              to_address,
                              from_address ? from_address : "automated@openvas.org",
                              subject,
                              body,
                              to_address);
...
if (ret = system (command)...
</pre>

<p>
As you can see, an attacker can influence both the to and from addresses
within the concatenated string.  The OpenVAS Manager uses the presence
of the file isadmin to determine the privileges associated with the
account.
</p>

<p>
The vulnerable code path is only accessible to authenticated users of
OpenVAS Manager however it may also be triggered either directly or
by using a cross-site request forgery based attack via the Greenbone
Security Assistant web application.
</p>

<h3>Fix</h3>

<p>
OpenVAS recommends that the publicly available patches are applied.  If
building from source, then either patch r9974 (trunk) or r9976 (1.0.x)
should be obtained from the OpenVAS SVN repository.  A fresh tarball
containing the latest stable release can be obtained from:
</p>

<ul>
<li>http://wald.intevation.org/frs/download.php/829/openvas-manager-1.0.4.tar.gz</li>
</ul>

<p>
In the event that OpenVAS has been supplied as part of a distribution
then the vendor or organisation concerned should be contacted for a
patch.
</p>

<h3>History</h3>

<p>
On 14th January 2011, Ronald Kingma contacted Greenbone Networks to
report the described vulnerability affecting OpenVAS Manager.
</p>

<p>
Greenbone Networks began working on patches to resolve the vulnerability.
Over the weekend of the 15th and 16th of January, Greenbone Networks
applied patches to resolve the vulnerability in trunk and the 1.0
branch respectively.
</p>

<p>
On the 17th, Greenbone Networks contacted the OpenVAS security team
to notify them of the vulnerability and request assistance in
coordinating the disclosure.  
</p>

<p>
The OpenVAS security team, Greenbone Networks and Ronald opened a
dialogue in order to draft this advisory and on the 18th, CVE-2011-0018
was assigned for this vulnerability.
</p>

<p>
The OpenVAS security team continued evaluating the vulnerability,
identifying that it may also be triggered using a cross-site request
forgery based attack.
</p>

<p>
OpenVAS Manager 1.0.4 was released on the 19th.
</p>

<p>
On the 24th, CVE-2011-0650 was assigned to the cross-site request forgery
based attack against the Greenbone Security Assistant web application.
Greenbone Networks confirm that they have a patch in development but that
substantive testing is still required. It is intended that the patch will
be incorporated in to Greenbone Security Assistant prior to the OpenVAS 4
release.
</p>

<h3>Thanks</h3>

<p>
OpenVAS would like to thank Ronald Kingma and Alexander van Eee
of ISSX for their help in reporting the vulnerability.
</p>
