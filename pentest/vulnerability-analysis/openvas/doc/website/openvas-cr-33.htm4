m4_dnl -*-html-*-
m4_include(`template.m4')

m4_dnl OpenVAS
m4_dnl $Id$
m4_dnl Description: OpenVAS Change Request #33
m4_dnl
m4_dnl Authors:
m4_dnl Jan-Oliver Wagner <jan-oliver.wagner@greenbone.net>
m4_dnl
m4_dnl Copyright:
m4_dnl Copyright (C) 2009 Greenbone Networks GmbH
m4_dnl
m4_dnl This program is free software; you can redistribute it and/or
m4_dnl modify it under the terms of the GNU General Public License
m4_dnl as published by the Free Software Foundation; either version 2
m4_dnl of the License, or (at your option) any later version.
m4_dnl
m4_dnl This program is distributed in the hope that it will be useful,
m4_dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
m4_dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
m4_dnl GNU General Public License for more details.
m4_dnl
m4_dnl You should have received a copy of the GNU General Public License
m4_dnl along with this program; if not, write to the Free Software
m4_dnl Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.

m4_define(`EN')
m4_define(`TITLE', `OpenVAS')
m4_define(`MAIN', `misc')



PAGE_START
<h2>OpenVAS Change Request #33: Change server-side NVT cache from binary dumps to keyfiles</h2>

<p>
Status: Voted +9. Done. Released with openvas-scanner 3.0.0.
</p>

<h3>Purpose</h3>

<p>
To remove size limitations for various NVT attributes: description,
dependencies, required keys etc.
</p>

<p>
To drop binary formats in favour of text formats that are human readable
and can more easily be handled via other programming languages.
</p>

<p>
To have standard procedures take care instead of self-invented solutions.
</p>

<h3>References</h3>

<p>
<a href="http://lists.wald.intevation.org/pipermail/openvas-devel/2009-June/001558.html">Discussion on openvas-devel</a>
</p>

<h3>Rationale</h3>

<p>
The current cache works with fixed sizes, and just dumps binary
memory blocks to filesystem and from filesystem to memory.
These memory blocks (openvas-libraries/libopenvas/store_internal.h)
impose fixed sizes for various attributes of NVTs, such as
description, dependencies, required keys etc.
</p>

<p>
Repeatingly it happened that the description, taken from
CVE, had to be shortened, that CVE references list had to be
shortened, etc. This lowers the quality of NVTs and should
better be improved.
</p>

<h3>Effects</h3>

<p>
The cache files will be renamed from *.desc to *.nvti, where
nvti stands for NVT information. Thus the old *.desc need
to be removed explicitely for a clean cache. The *.desc
files do no harm other than consuming disc space though.
</p>

<p>
Given the proposed solution based on keyfiles, the loading times
and disc consumption will change:
</p>

<ul>
<li> openvasd startup time with empty cache: almost the same
<li> openvasd startup time with filled cache: doubled (drops from ~4000 NVTs per second to ~2000 NVT per second on a simple laptop).
<li> disc space consumption of cache: drops to ~1/3 of the current solution (from 142M to 48M at ~12000 NVTs)
</ul>

<h3>Design and Implementation</h3>

<p>
The new cache files will be <a href="http://library.gnome.org/devel/glib/stable/glib-Key-value-file-parser.html">glib keyfiles</a>.
</p>

<p>
A new layer for managing the NVT information will be applied between the
keyfiles and the current plugin-layer. It is envisioned to replace
this plugin layer entirely eventually. This layer is already
implemenented in the module openvas-libraries/libopenvascommon/nvti.o
but not yet used in openvas-libraries. nvti.o is curently only
used by openvas-manager.
</p>

<p>
Changes for switching the cache mechanism will only be applied
to file openvas-libraries/libopenvas/store.c.
It is expected that initially, the implementation will be suboptimal
in terms of code size. These could be cleaned up when also improving
openvas-libraries/libopenvas/plugutils.c.
</p>

<p>
The change will be introduced to openvas-libraries 2.1-series.
</p>

<h3>History</h3>

<ul>
<li> 2010-01-06 Felix Wolfsteller &lt;felix.wolfsteller@intevation.de&gt;:<br>
     Updated status as done.</li>
<li> 2009-06-12 Jan-Oliver Wagner &lt;jan-oliver.wagner@greenbone.net&gt;:<br>
     Added voting results.</li>
<li> 2009-06-05 Jan-Oliver Wagner &lt;jan-oliver.wagner@greenbone.net&gt;:<br>
     Initial text.</li>
</ul>
