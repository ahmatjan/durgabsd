m4_dnl -*-html-*-
m4_include(`template.m4')

m4_dnl OpenVAS
m4_dnl $Id$
m4_dnl Description: OpenVAS Change Request #60 (NVT directory structure)
m4_dnl
m4_dnl Authors:
m4_dnl Jan-Oliver Wagner <jan-oliver.wagner@greenbone.net>
m4_dnl
m4_dnl Copyright:
m4_dnl Copyright (C) 2012 Greenbone Networks GmbH
m4_dnl
m4_dnl This program is free software; you can redistribute it and/or
m4_dnl modify it under the terms of the GNU General Public License
m4_dnl as published by the Free Software Foundation; either version 2
m4_dnl of the License, or (at your option) any later version.
m4_dnl
m4_dnl This program is distributed in the hope that it will be useful,
m4_dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
m4_dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
m4_dnl GNU General Public License for more details.
m4_dnl
m4_dnl You should have received a copy of the GNU General Public License
m4_dnl along with this program; if not, write to the Free Software
m4_dnl Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.

m4_define(`EN')
m4_define(`TITLE', `OpenVAS')
m4_define(`MAIN', `misc')

PAGE_START
<h2>OpenVAS Change Request #60: NVT directory structure</h2>

<p>
Status: Voted +10. In developement.
</p>

<h3>Purpose</h3>

<p>
Avoid huge number of files in a single directory
by using subdirectories for each year where NVTs are placed
created in that year.
</p>


<h3>References</h3>

<ul>
  <li>
  <a href="http://lists.wald.intevation.org/pipermail/openvas-plugins/2012-February/000806.html">Discussion
    on mailing list openvas-plugins from February 2012</a>
  </li>
  <li>
  <a href="http://lists.wald.intevation.org/pipermail/openvas-plugins/2012-October/000912.html">Continued discussion
    on mailing list openvas-plugins from October 2012</a>
  </li>
  <li>
  <a href="openvas-cr-24.html">OpenVAS CR #24: OpenVAS-Server: Reorganize NVTs in Subdirectories</a>: The CR
    that introduced subdirectories and covered early ideas how to organize structure.
  </li>
</ul>

<h3>Rationale</h3>

<p>
Currently, the main NVT directory contains almost 30,000 NVTs.
The Feed directory with one detached signature file per NVT contains
therefore already almost 60,000 files.
</p>

<p>
The large number of files in a single directory creates several problems:
</p>

<ul>

<li>
<p>
Some file systems may get into trouble with such large number of files in
a single directory. This affects OpenVAS installations using the feed service.
</p>
</li>

<li>
<p>
It is problematic to handle such a directory manually, for example to find
a special file.
</p>
</li>

<li>
<p>
Subversion gets into performance problems with this situation.
</p>
</li>

</ul>

<p>
When segregated by year of creation we will never have to
worry about excess scripts in any year. It is easy
to manage and not tied to category or any other metric.
</p>

<p>
Early ideas were about using the OID structure for segregation.
This may not ensure a more or less equal distribution across
subdirectories and also the OID strategy has not settled yet.
</p>

<h3>Effects</h3>

<p>
A main effect would be that the OpenVAS NVT Feed synchronisation script
does not delete files not present in the feed service.
This makes it difficult to move files into subdirectories because it
would create numerous duplicates.
Starting in 2013 with a subdirectory 2013/ would mean no problem.
</p>

<p>
For OpenVAS-6, the removal can be made default, so that OpenVAS-6
users will not have problems once later on we move files.
Of course, the moving of files of 2012 and earlier could only be done
after OpenVAS-5 is retired.
</p>

<p>
It would be very important then to inform users migrating to OpenVAS-6
that any NVTs in their plugins directory that are not part of the feed
service will be removed.
</p>

<p>
A downside is that finding a filename to a given
OID or family is not straight-forward possible via the directory tree.
However, this search is offered via the OpenVAS website.
</p>

<h3>Design and Implementation</h3>

<p>
The following steps would need to be done:
</p>

<ol>

<li>
<p>
Create directory openvas-plugins/scripts/2013 and start committing new
scripts in 2013 into that directory. Only exceptions: a) If they belong
to one of the groups already collected in another directory such as
GSHB or the NSE wrappers. b) include files, c) NVTs that are used as
dependencies.
</p>
</li>

<li>
<p>
Adjust the sync script to create a directory "private" if it does not exist
yet and to exclude removal of it and its content during synchronisation.
Make it part of OpenVAS-6.
</p>
</li>


<li>
<p>
Create a script which help users to figure out which of
their NVTs are not part of the OpenVAS NVT Feed and offer to move them
to the subdirectory "private/".
This should be as simple check where NVTs are lacking an OpenVAS signature.
It needs to be taken care to only check the OpenVAS signature and not
other valid signatures a user might have configured and used.
Make this part of OpenVAS-6, helper routine probably best as part of
openvas-nvt-sync when called with a special parameter (like --migrate-to-private).
</p>
</li>

</ol>

<h3>History</h3>

<ul>
  <li> 2013-03-19 Jan-Oliver Wagner &lt;jan-oliver.wagner at greenbone dot net&gt;:<br/>
    All items are implemented with OpenVAS-6. Once OpenVAS-5 is retired, directories
    2012/, 2011/ etc. can be created and the files be moved there.
  </li>
  <li> 2012-12-18 Jan-Oliver Wagner &lt;jan-oliver.wagner at greenbone dot net&gt;:<br/>
    Added voting results and setting to "in development".
  </li>
  <li> 2012-12-12 Jan-Oliver Wagner &lt;jan-oliver.wagner at greenbone dot net&gt;:<br/>
    Initial text.
  </li>
</ul>
