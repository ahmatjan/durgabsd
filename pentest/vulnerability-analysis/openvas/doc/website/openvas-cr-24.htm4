m4_dnl -*-html-*-
m4_include(`template.m4')

m4_dnl OpenVAS
m4_dnl $Id$
m4_dnl Description: OpenVAS Change Request #24
m4_dnl
m4_dnl Authors:
m4_dnl Michael Wiegand <michael.wiegand@intevation.de>
m4_dnl Stjepan Gros <sgros.ml@gmail.com>
m4_dnl
m4_dnl Copyright:
m4_dnl Copyright (C) 2008 Intevation GmbH
m4_dnl
m4_dnl This program is free software; you can redistribute it and/or
m4_dnl modify it under the terms of the GNU General Public License
m4_dnl as published by the Free Software Foundation; either version 2
m4_dnl of the License, or (at your option) any later version.
m4_dnl
m4_dnl This program is distributed in the hope that it will be useful,
m4_dnl but WITHOUT ANY WARRANTY; without even the implied warranty of
m4_dnl MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
m4_dnl GNU General Public License for more details.
m4_dnl
m4_dnl You should have received a copy of the GNU General Public License
m4_dnl along with this program; if not, write to the Free Software
m4_dnl Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.

m4_define(`EN')
m4_define(`TITLE', `OpenVAS')
m4_define(`MAIN', `misc')



PAGE_START
<h2>OpenVAS Change Request #24: OpenVAS-Server: Reorganize NVTs in Subdirectories</h2>

<p>
Status: Voted +6. Developed and releases since OpenVAS 3.
</p>

<h3>Purpose</h3>

<p>
To make maintaining the collection of NVTs easier.
</p>

<p>
To be compliant with LSB/FHS.
</p>

<h3>References</h3>

<p>
<ul>
<li> <a href="http://lists.wald.intevation.org/pipermail/openvas-devel/2008-October/001014.html">Initial Patch
suggested by Stjepan Gros on openvas-devel</a><br>
<li> <a href="http://lists.wald.intevation.org/pipermail/openvas-devel/2008-December/001132.html">More discussion of the feature on openvas-devel</a><br>
<li> <a href="http://lists.wald.intevation.org/pipermail/openvas-devel/2008-December/001216.html">Updated Patch on openvas-devel</a><br>
<li> <a href="http://lists.wald.intevation.org/pipermail/openvas-devel/2008-December/001231.html">Fully working patch on openvas-devel</a>
</ul>
</p>

<h3>Rationale</h3>

<p>
Right now, the OpenVAS-Server expects all NVTs to be in one single directory on
the server machine and will only look in this directory when looking for NVTs
when starting up. Also, plugins are placed inside lib subdirectory but they
are platform independent, read-only data which is better placed in share
subdirectory. Likewise, the server creates one single subdirectory for
cached NVT data inside plugins subdirectory which has two drawbacks. First,
it requires write access in what should be read-only directory and, second,
it will only use this cache directory.
</p>

<p>
The current approach poses two problems. First, as the NVT collection gets
larger and larger, especially if the user subscribes to one or more high
volume NVT feeds. This could lead to unexpected and undesirable results,
for example when different feeds contain files with the same file name.
If different feeds could be isolated into different directories, this would
improve the situation for feed subscribers as well as feed managers. The
second problem is that this directory organisation doesn't align well with
<a href="http://www.pathname.com/fhs/pub/fhs-2.3.html#USRSHAREARCHITECTUREINDEPENDENTDATA">FHS</a>
(and indirectrly with LSB) and how distributions distribute files on
file system. 
</p>

<p>
Furthermore, it may not always be necessary to load all NVTs available to the
server on startup; with different directories, the server would be able to make
only a subset of his NVTs available to connecting client for security or speed
reasons.
</p>

<h3>Effects</h3>

<p>
The code changes will not break existing installations upgrading to a new
version of OpenVAS, or new installations that do not explicitly specify
alternative path to plugins and include directories.
</p>

<p>
The critical change will be when/if plugins themselves are reorganized and
feeds change structure. This could break old/existing installations.
This has to be further discussed.
</p>

<p>
Three new configuration directives will be introduced that control OpenVAS
behavior with respect to where plugins are placed: include_folder,
plugins_folder and cache_folder.
</p>

<h3>Design and Implementation</h3>

<p>
Cache directory will be subdivided into a set of one letter
directories. Each plugin will be placed into appropriate
subdirectory based on the first letter of the name. The other
possibility (maybe better) is to use OID as a name for the
plugin in a cache and possibly for the organization of the
directory structure.
</p>

<p>
Modify openvas-server/openvasd/nasl_plugins.c to propagate additional
info about plugin and include directories to openvas-libnasl component.
</p>

<p>
Modify openvas-server/openvasd/openvasd.c to include old style
behavior in case none of include_folder, plugins_folder and cache_folder
were given in the configuration file.
</p>

<p>
Modify openvas-server/openvasd/pluginload.c to recurse through given
plugin directories and load all the plugins.
</p>

<p>
Modify openvas-libnasl/nasl subsystem to search include directories.
And grammar to include new directives.
</p>

<h3>History</h3>

<ul>
<li> 2012-12-12 Jan-Oliver Wagner &lt;jan-oliver.wagner@greenbone.net&gt;:<br>
     Set to Developed and released. Rules for organization are revised
     with OpenVAS CR #60.</li>
<li> 2009-01-02 Michael Wiegand &lt;michael.wiegand@intevation.de&gt;:<br>
     Updated Status.</li>
<li> 2008-12-29 Jan-Oliver Wagner &lt;jan-oliver.wagner@intevation.de&gt;:<br>
     Updated References and Purpose.</li>
<li> 2008-12-04 Stjepan Gros &lt;sgros.ml@gmail.com&gt;:<br>
     Link on FHS/LSB<br>
     Additional details in design and implementation section<br>
     </li>
<li> 2008-12-02 Stjepan Gros &lt;sgros.ml@gmail.com&gt;:<br>
     Rephrasing rationale<br>
     </li>
<li> 2008-11-26 Michael Wiegand &lt;michael.wiegand@intevation.de&gt;:<br>
     Initial text.</li>
</ul>
