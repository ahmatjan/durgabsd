top_srcdir = .
srcdir = .
prefix = /usr/local
datarootdir = ${prefix}/share
exec_prefix = ${prefix}
bindir = ${exec_prefix}/bin
mandir = ${datarootdir}/man

CC = gcc
CFLAGS = -g -O2 -Wall -Wno-deprecated-declarations
CPPFLAGS =    -I/usr/local/include/apr-1  $(DEFS) -I$(NBASEDIR)
LDFLAGS = 
LIBS =  $(NBASELIB)
DEFS = -DHAVE_CONFIG_H -D_FORTIFY_SOURCE=2
APR_LIBS =  -L/usr/local/lib -lapr-1
SVN_LIBS =  -lsvn_client-1 -lsvn_subr-1 -lapr-1

INSTALL = /usr/bin/install -c
STRIP = /usr/bin/strip
SHTOOL = ../shtool

DESTDIR =

SOURCES = nmap-update svn_auth
C_FILES = $(addsuffix .c,$(SOURCES))
O_FILES = $(addsuffix .o,$(SOURCES))

NBASEDIR = ../nbase
NBASELIB = $(NBASEDIR)/libnbase.a

all: nmap-update

nmap-update: $(O_FILES) $(NBASELIB)
	$(CC) -o $@ $(CFLAGS) $(LDFLAGS) $^ $(APR_LIBS) $(SVN_LIBS) $(LIBS)

%.o: %.c
	$(CC) -c -o $@ $(CPPFLAGS) $(CFLAGS) $<

$(NBASELIB):
	cd $(NBASEDIR) && $(MAKE)

install: nmap-update
	$(SHTOOL) mkdir -f -p -m 755 $(DESTDIR)$(bindir) $(DESTDIR)$(mandir)/man1
	$(INSTALL) -c -m 755 nmap-update $(DESTDIR)$(bindir)
	$(STRIP) -x $(DESTDIR)$(bindir)/nmap-update
	$(INSTALL) -c -m 644 ../docs/nmap-update.1 $(DESTDIR)$(mandir)/man1/

uninstall:
	$(RM) -f $(DESTDIR)$(bindir)/nmap-update

clean:
	rm -f nmap-update *.o

distclean: clean
	rm -f Makefile makefile.dep

Makefile: Makefile.in
	./config.status

makefile.dep:
	$(CC) -MM $(CPPFLAGS) $(C_FILES) > $@
include makefile.dep

.PHONY: all clean
