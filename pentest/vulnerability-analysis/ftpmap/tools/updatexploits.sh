#!/usr/bin/env bash
# updatexploits.sh - update the exploits.h file.
# 
# Copyright (C) 2015 by Hypsurus <hypsurus@mail.ru> (gpl3)
#
# Reversion 1.
#
# This too will download the exploit-db csv file. 
# and will write it to exploits.h
#


D="/usr/bin/wget"
DB="https://raw.githubusercontent.com/offensive-security/exploit-database/master/files.csv"

echo -e "\033[01;32m@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
echo -e "@ Update exploits.h tool for FTPMap >= 0.11 @"
echo    "@            by Hypsurus                    @"
echo -e "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\033[00m\n"

function e() {
if [ ! -f $1 ];then
    echo "[!] $1 not found"
    exit 1
else
    echo "[*] $1 found!]"
fi 
}

# Check for dep
e $D

echo "[+] Downloading database ..."
`$D -q $DB` 

e ./files.csv 

ln=`wc ../src/exploits.h -l`

echo "[+] Updateing the header file."
grep -i  "FTPD" files.csv | sed 's/\"//g'  | awk -F , 'BEGIN {
print "/* exploits.h - FTP servers exploit. */\n";
print "/* Created by the updatexploits.sh tool by Hypsurus */\n"
print "const char *exploits[] = {"
}
{
printf("\t\t\"%s %s\",\n", $1, $3);
}
END {
print "\t\t\"\",\n};"}' > ../src/exploits.h 

echo -e "[*] Finshed!\n-> Old exploit.h - $ln\n-> New exploits.h: $(wc ../src/exploits.h -l)"
echo "[!] Removing files.csv"
rm ./files.cs*
